{% extends "base.html" %}
{% block content %}

<h2>ğŸ“ Edit Order #{{ order.id }}</h2>

<form method="post">
    {% csrf_token %}
    {{ form.as_p }}


    <h3>Order Items</h3>
    {{ formset.management_form }}

    <table id="order-items">
        {% for f in formset %}
        <tr class="order-item-form">
            <!-- Ù…Ù‡Ù…: hidden fields -->
            {{ f.id }}
            {{ f.order }}

            <td>{{ f.menuitem }}</td>
            <td>{{ f.quantity }}</td>
            
        </tr>
        {% endfor %}
    </table>

    <!-- ÙÙˆØ±Ù… ÙØ§Ø¶ÙŠ Ù‡Ù†Ø³ØªØ®Ø¯Ù…Ù‡ ÙƒÙ€ template -->
    <table style="display:none;">
        <tr id="empty-form" class="order-item-form">
            {{ formset.empty_form.id }}
            {{ formset.empty_form.order }}
            <td>{{ formset.empty_form.menuitem }}</td>
            <td>{{ formset.empty_form.quantity }}</td>
            <td></td>
        </tr>
    </table>

    <button type="button" id="add-item" class="btn btn-info">â• Add another item</button>
    <br><br>
    <button type="submit" class="btn btn-success">ğŸ’¾ Save</button>


</form>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const addButton = document.getElementById("add-item");
        const formsetTable = document.getElementById("order-items");
        const totalForms = document.getElementById("id_items-TOTAL_FORMS");

        addButton.addEventListener("click", function() {
            let formIndex = parseInt(totalForms.value);
            let newFormHtml = document.getElementById("empty-form").outerHTML.replace(/__prefix__/g, formIndex);

            let tempDiv = document.createElement("tbody");
            tempDiv.innerHTML = newFormHtml;
            let newRow = tempDiv.firstElementChild;

            newRow.querySelectorAll("input, select").forEach(el => {
                if (el.tagName === "INPUT") el.value = (el.type === "number") ? 1 : "";
            });

            formsetTable.appendChild(newRow);
            totalForms.value = formIndex + 1;
        });

        // âœ… Ø¶Ù…Ø§Ù† Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ (Ø­ØªÙ‰ hidden)
        document.querySelector("form").addEventListener("submit", function() {
            document.querySelectorAll("#order-items input, #order-items select").forEach(el => {
                el.disabled = false; // Ù†Ø¶Ù…Ù† Ø¥Ù†Ù‡Ø§ ÙƒÙ„Ù‡Ø§ ØªØªØ¨Ø¹Øª
            });
        });
    });
</script>


{% endblock %}
