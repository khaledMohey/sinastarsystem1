{% extends "base.html" %}
{% block content %}
<div class="container py-5">
  <h2 class="mb-4 text-dark">
    Order #{{ order.id }} 
    {% if order.order_type == "cafe" %}
      <span class="badge bg-info">Cafe</span>
      - Table {{ order.table_number }}
    {% elif order.order_type == "takeaway" %}
      <span class="badge bg-warning text-dark">Takeaway</span>
    {% elif order.order_type == "qeta3" %}
      <span class="badge bg-warning text-dark">Qeta3</span>
      {% if order.officer %}
        - <span class="text-dark">ğŸ‘® {{ order.officer.name }}</span>
      {% endif %}
    {% endif %}
  </h2>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© -->
  <div class="mb-3">
    <button class="btn btn-outline-info btn-sm" onclick="filterItems('all')">Ø§Ù„ÙƒÙ„</button>
    <button class="btn btn-outline-primary btn-sm" onclick="filterItems('barista')">â˜• Ø¨Ø§Ø±ÙŠØ³ØªØ§</button>
    <button class="btn btn-outline-warning btn-sm" onclick="filterItems('mat3am')">ğŸ½ï¸ Ù…Ø·Ø¹Ù…</button>
    <button class="btn btn-outline-secondary btn-sm" onclick="filterItems('canteen')">ğŸ¥ª ÙƒØ§Ù†ØªÙŠÙ†</button>
    <button class="btn btn-outline-dark btn-sm" onclick="filterItems('7alak')">ğŸ’ˆ Ø­Ù„Ø§Ù‚</button>
    <button class="btn btn-outline-danger btn-sm" onclick="filterItems('shesha')">ğŸ’¨ Ø´ÙŠØ´Ø©</button>
  </div>

  <table class="table table-dark table-bordered">
    <thead>
      <tr>
        <th>Item</th>
        <th>Section</th>
        <th>Quantity</th>
        <th>Unit Price</th>
        <th>Total</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for item in order.items.all %}
      <tr class="order-item" data-section="{{ item.section }}">
        <td>{{ item.menuitem.name }}</td>
        <td>
          {% if item.menuitem.section == "barista" %}
            â˜• Ø¨Ø§Ø±ÙŠØ³ØªØ§
          {% elif item.menuitem.section == "mat3am" %}
            ğŸ½ï¸ Ù…Ø·Ø¹Ù…
          {% elif item.menuitem.section == "canteen" %}
            ğŸ¥ª ÙƒØ§Ù†ØªÙŠÙ†
          {% elif item.menuitem.section == "7alak" %}
            ğŸ’ˆ Ø­Ù„Ø§Ù‚
          {% elif item.menuitem.section == "shesha" %}
            ğŸ’¨ Ø´ÙŠØ´Ø©
          {% else %}
            {{ item.get_section_display }}
          {% endif %}
        </td>
        <td>{{ item.quantity }}</td>
        <td>${{ item.menuitem.price }}</td>
        <td>${{ item.total_price }}</td>
        <td>
          <button class="btn btn-success btn-sm" onclick="markDone(this)">âœ” ØªÙ…</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th colspan="5" class="text-end">Subtotal:</th>
        <td>${{ order.subtotal }}</td>
      </tr>
      {% if order.discount > 0 %}
      <tr>
        <th colspan="5" class="text-end">Discount:</th>
        <td>- ${{ order.discount }}</td>
      </tr>
      {% endif %}
      {% if order.service_charge > 0 %}
      <tr>
        <th colspan="5" class="text-end">Service Charge:</th>
        <td>+ ${{ order.service_charge }}</td>
      </tr>
      {% endif %}
      {% if order.tax > 0 %}
      <tr>
        <th colspan="5" class="text-end">Tax (14%):</th>
        <td>+ ${{ order.tax }}</td>
      </tr>
      {% endif %}
      <tr class="table-success">
        <th colspan="5" class="text-end">Total:</th>
        <td><strong>${{ order.total }}</strong></td>
      </tr>
    </tfoot>
  </table>

  <div class="mt-3">
    <a href="{% url 'orders_list' %}" class="btn btn-secondary">Back to Orders</a>
  </div>
</div>

<!-- JavaScript Ù„Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø£ØµÙ†Ø§Ù -->
<script>
  function filterItems(section) {
    const rows = document.querySelectorAll(".order-item");
    rows.forEach(row => {
      if (section === "all" || row.dataset.section === section) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }

  function markDone(button) {
    const row = button.closest("tr");
    row.classList.add("table-success");
    button.disabled = true;
    button.textContent = "âœ” ØªÙ…";
  }
</script>
{% endblock %}
